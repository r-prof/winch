PKG_CPPFLAGS = -Ilocal/include -Dabort=R_abort

all: local/lib/libbacktrace.a

build/libbacktrace/Makefile: vendor/libbacktrace/configure
	mkdir -p build/libbacktrace && cd build/libbacktrace && CC="$(CC)" AR="$(AR)" RANLIB="$(RANLIB)" PKG_CPPFLAGS="-Dabort=R_abort" ../../vendor/libbacktrace/configure --disable-host-shared --prefix=$${PWD}/../../local

local/lib/libbacktrace.a: build/libbacktrace/Makefile vendor/libbacktrace/*.c vendor/libbacktrace/*.h
	cd build/libbacktrace && $(MAKE) install
